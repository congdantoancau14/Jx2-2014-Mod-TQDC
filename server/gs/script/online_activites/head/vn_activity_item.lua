Include("\\script\\lib\\globalfunctions.lua");
Include("\\settings\\static_script\\cheat\\event\\event_init.lua");
Include("\\script\\online\\eating\\eating_head.lua");

ListGif_1 = {
	-- {"Thiªn M«n Kim LÖnh", 20, {2,1,30370,1},0},
	-- {"Thiªn Cang LÖnh", 20, {2,95,204,1},0},
	-- {"R­¬ng S¾t NguyÖt Thè", 10, {2,0,606,1},0},
	-- {"Hu©n Ch­¬ng Anh Hïng", 60, {2,1,30499,5},0},
	-- {"Cæ Linh Ngäc", 60, {2,1,30369,1},0},
	-- {"Cæ Linh Th¹ch", 60, {2,1,30368,1},0},
	-- {"§Ünh Hån Thiªn Th¹ch ThÇn Th¹ch", 1, {2,1,1067,1},0},
	-- {"§¹i §Ünh Hån", 1, {2,1,1113,1},0},
	-- {"Thiªn Th¹ch Linh Th¹ch", 1, {2,1,1068,1},0},
	-- {"Thiªn Th¹ch Tinh Th¹ch", 47, {2,1,1009,5},0},
	-- {"Kinh M¹ch §ång Nh©n", 60, {2,1,30730,1},0},
	-- {"C­êng Hãa QuyÓn 12", 59, {2, 1, 30424, 1},0},
	-- {"C­êng Hãa QuyÓn 13", 49, {2, 1, 30425, 1},0},
	-- {"C­êng Hãa QuyÓn 14", 39, {2, 1, 30426, 1},0},
	-- {"C­êng Hãa QuyÓn 15", 30, {2, 1, 30427, 1},0},
	-- {"Th¸i NhÊt LÖnh", 50, {2,1,30687,10},0},
	-- {"ThiÕt Tinh CÊp 4", 40, {2, 1, 30612, 1},0},
	
	{"R­¬ng B¶o Th¹ch",10,{2,1,30004,1},0},
	{"Tói tr¸i c©y",10,{2,1,30008,1},0},
	{"M¶nh linh th¹ch",10,{2,1,2646,1},0},
	{"Tinh hoa uÈn linh cÊp 4",10,{2,1,30666,1},0},
	{"Tinh hoa uÈn linh cÊp 5",10,{2,1,30667,1},0},
	{"Tinh hoa uÈn linh cÊp 6",10,{2,1,30668,1},0},
	{"M¶nh mËt tÞch",10,{2,1,30669,1},0},
	{"Linh th¹ch nguyªn th¹ch cÊp 1",10,{2,1,30413,1},0},
	{"Linh th¹ch nguyªn th¹ch cÊp 2",10,{2,1,30414,1},0},
	{"Linh th¹ch nguyªn th¹ch cÊp 3",10,{2,1,30415,1},0},
	{"Linh th¹ch nguyªn th¹ch cÊp 4",10,{2,1,30416,1},0},
	{"Linh th¹ch nguyªn th¹ch cÊp 5",10,{2,1,30417,1},0},
	{"Linh th¹ch nguyªn th¹ch cÊp 6",10,{2,1,30418,1},0},
	{"Linh th¹ch nguyªn th¹ch cÊp 7",10,{2,1,30419,1},0},
	-- {"V¹n B¶o ®å",10,{2,1,2643,1},0},
	{"Phèi chÕ linh th¹ch",10,{2,1,2641,1},0},
};

ListGif_2 = {

	{"Méc R­¬ng",10,{2,1,30340,1},0},
	{"Tµng R­¬ng",10,{2,1,30341,1},0},
	{"Kim R­¬ng",10,{2,1,30342,1},0},
	{"B¹ch Kim R­¬ng",10,{2,1,30343,1},0},
	{"ThÇn Tµi B¶o R­¬ng",10,{2,1,30344,1},0},
	-- {"Thiªn Th¹ch Tinh Th¹ch", 50, {2,1,1009,5},0},
	-- {"Hu©n Ch­¬ng Anh Hïng", 60, {2,1,30499,2},0},
	-- {"Cæ Linh Ngäc", 60, {2, 1, 30369, 2},0},
	-- {"Cæ Linh Th¹ch", 60, {2, 1, 30368, 2},0},
	{"Trøng Linh Thó", 20, {2,1,30728,1},0},
	
	-- {"Qu©n C«ng Vinh Dù", 1, {2,1,30642,1},0},
	-- {"Kinh M¹ch Ng©n Nh©n", 10, {2,1,30731,1},0},
	-- {"Kinh M¹ch Kim Nh©n", 50, {2,1,30732,1},0},
	-- {"Háa Phông Tinh Hoa", 50, {2,1,30770,1},0},
	-- {"Th¸i NhÊt LÖnh", 50, {2,1,30687,10},0},
	-- {"Háa Phông Tinh Hoa", 10, {2,1,30770,2},0},
	-- {"Thiªn M«n Kim LÖnh", 20, {2,1,30370,1},0},
	-- {"Thiªn Cang LÖnh", 20, {2,95,204,20},0},
	-- {"M¶nh Thiªn M«n", 10, {2, 1, 30410, 10},0},
	-- {"M¶nh Thiªn Cang", 10, {2, 1, 30390, 50},0},
	-- {"ThiÕt Tinh CÊp 4", 40, {2, 1, 30612, 1},0},
};

ListGif_3 = {
	{"B¶o r­¬ng thÇn bÝ",10,{2,0,139,1},0},
	-- {"Tói trang bÞ kim xµ 4 sao",10,{2,1,31261,1},0},
	{"Bao thiªn th¹ch tinh th¹ch",10,{2,1,1051,1},0},
	--{"Hép quµ ¸o n¨m míi",10,{2,1,30000,1},0},
	{"Tµng Hoµng kim bao",10,{2,1,204,1},0},	
	{"NhÊt §¼ng S¸t Thñ bao",10,{2,1,205,1},0},	
	{"Nh× §¼ng S¸t Thñ bao",10,{2,1,206,1},0},	
	{"Tam §¼ng S¸t Thñ bao",10,{2,1,207,1},0},	
	{"§¹i Hång bao",10,{2,1,212,1},0},	
	{"TiÓu Hång bao",10,{2,1,213,1},0},	
	{"Thanh Phong Bao",10,{2,1,370,1},0},	
	{"Hång bao",10,{2,1,508,1},0},	
	{"Tö Kim Hång Bao",10,{2,1,537,1},0},	
	{"Siªu B¹ch Kim LÔ Bao",10,{2,1,1104,1},0},	
		
	{"§æ hiÖp ngu~ th­ëng bao",10,{2,1,1112,1},0},	
	{"Thµnh ThÕ Giang S¬n Bao",10,{2,1,3354,1},0},	
	{"T«n Quý LÔ Bao",10,{2,1,3355,1},0},	
	{"T«n Quý Trang BÞ Bao",10,{2,1,3357,1},0},
	{"Vâ L©m T«n Quý bao",10,{2,1,3358,1},0},	
	{"Kú Phóc Bao",10,{2,1,3375,1},0},	
	{"Trung Hoa Phóc bao",10,{2,1,3381,1},0},	
	{"Hû Nghªnh Thµnh Héi bao",10,{2,1,3382,1},0},	
	{"B¸t B¸t Ngo¹i Trang Bao",10,{2,1,3383,1},0},	
	{"Khiªm Vu~ Ngo¹i Trang Bao",10,{2,1,3384,1},0},	
	{"B¸ch Niªn Viªn Méng Bao",10,{2,1,3385,1},0},	
	{"Hoan Thiªn Hû §Þa Bao",10,{2,1,3387,1},0},	
	{"Kû niÖm 20 n¨m §iÓn bao",10,{2,1,3389,1},0},	

};

ListGif_4 = {
	{"L× x× n¨m míi",10,{2,1,30001,1},0},
	{"MËu Tý ®¹i hång bao",10,{2,1,30002,1},0},
	{"Ph¸o hoa",10,{2,1,30003,1},0},
	{"TiÓu c¸t t­êng",10,{2,1,30014,1},0},
	{"Hoan linh sa",10,{2,2,2647,1},0},
	{"Tô linh sa",10,{2,1,2648,1},0},
	{"Ngäc bÝch t©m",10,{2,1,2649,1},0},
	{"Ngäc bÝch hån",10,{2,1,2650,1},0},
	{"Tói chiÕn háa Liªu thµnh",10,{2,1,1167,1},0},
	{"Tiªu dao hép",10,{2,1,1168,1},0},
	{"NguyÖt l­¬ng hép",10,{2,1,1169,1},0},
	{"KiÕm hiÖp t×nh duyªn hép",10,{2,1,1170,1},0},
	{"Sao cÇu nguyÖn",10,{2,1,1171,1},0},
	{"Tói Long §»ng tø h¶i",10,{2,1,1172,1},0},
	{"NguyÖt hoa ®Æc biÖt",10,{2,1,1173,1},0},
	{"Tô Linh th¹ch",10,{2,1,1174,1},0},
	{"Tói Hßa hµi thµnh héi",10,{2,1,1175,1},0},
	{"B¸ch B¶o R­¬ng",10,{2,1,30111,1},0},
	{"R­¬ng S¾t NguyÖt Thè", 10, {2,0,606,1},0},
};

ListGif_5 = {
	{"T¸i chiÕn giang hå-§¹i lÔ bao",10,{2,1,1105,1},0},	
	{"T¸i chiÕn giang hå-Hµo hoa lÔ bao",10,{2,1,1106,1},0},	
	{"T¸i chiÕn giang hå-ChÝ t«n lÔ bao",10,{2,1,1107,1},0},
};

nItem = 0;

function OnUse(nItemIndex)
	local nDate = CheckDate();
	local nYears,nMonths,nDays = GmTime(GetTime()+86400*7);
	nItem = GetItemParticular(nItemIndex);
	nFinalItem = Event_List[nDate]["final_item"];
	--print("getExpireTime: "..getExpireTime())
	if nFinalItem[1][3][3] == nItem then
		local TaskItem = TASK_MOD:GetTask(nFinalItem[1][5]);
		
		if TaskItem >= 2000 then
			Talk(1,"","Trong sù kiÖn lÇn nµy, b¹n ®· dïng tèi ®a "..Max_Event.." vËt phÈm")
			return
		end
	
		DelItem(nFinalItem[1][3][1], nFinalItem[1][3][2], nFinalItem[1][3][3], 1);
		
		local nRand, nName = GetRandByID(ListGif_1);
		local nRet, nItemIdx = gf_AddItemEx2(ListGif_1[nRand][3],ListGif_1[nRand][1]);
		--gf_SetItemExpireTime(nItemIdx,nYears,nMonths,nDays,23,59,0);
		Msg2Player("B¹n nhËn ®­îc "..ListGif_1[nRand][3][4].." "..nName);
		
		ModifyExp(2000000);
		Msg2Player("B¹n nhËn ®­îc 2.000.000 Kinh NghiÖm");
		
		local Random = random(1,100);
		if Random <= 10 then 
			ModifyExp(5000000);
			Msg2Player("B¹n nhËn ®­îc 5.000.000 Kinh NghiÖm");
		end
		bonus();
		TASK_MOD:SetTask(nFinalItem[1][5], TaskItem + 1);
		return
	end
	
	if nFinalItem[2][3][3] == nItem then
		local TaskItem = TASK_MOD:GetTask(nFinalItem[2][5]);
		
		if TaskItem >= 2000 then
			Talk(1,"","Trong sù kiÖn lÇn nµy, b¹n ®· dïng tèi ®a "..Max_Event.." vËt phÈm")
			return
		end
	
		DelItem(nFinalItem[2][3][1], nFinalItem[2][3][2], nFinalItem[2][3][3], 1);
		
		local nRand, nName = GetRandByID(ListGif_2);
		local nRet, nItemIdx = gf_AddItemEx2(ListGif_2[nRand][3],ListGif_2[nRand][1]);
		--gf_SetItemExpireTime(nItemIdx,nYears,nMonths,nDays,23,59,0);
		Msg2Player("B¹n nhËn ®­îc "..ListGif_2[nRand][3][4].." "..nName);
		
		ModifyExp(5000000);
		Msg2Player("B¹n nhËn ®­îc 2.000.000 Kinh NghiÖm");
		
		local Random = random(1,100);
		if Random <= 10 then 
			ModifyExp(10000000);
			Msg2Player("B¹n nhËn ®­îc 10.000.000 Kinh NghiÖm");
		end
		bonus();
		TASK_MOD:SetTask(nFinalItem[2][5], TaskItem + 1);
		
		return
	end
	
	--Msg2Player("Activity item index: "..nDate);
	--Talk(1,"","Event ®· kÕt thóc nªn ®¹i hiÖp kh«ng thÓ sö dông vËt phÈm nµy ®­îc n÷a !")
	-- Hªt h¹n vÉn cø sö dông :)
	if DelItem(2,1,nItem, 1) then
		local ChoosenTableReward = {}
		if random(1,3) < 3 then
			ChoosenTableReward = ListGif_1
		else
			ChoosenTableReward = ListGif_2
		end
		local nRand, nName = GetRandByID(ChoosenTableReward);
		local nRet, nItemIdx = gf_AddItemEx2(ChoosenTableReward[nRand][3],ChoosenTableReward[nRand][1]);
		--gf_SetItemExpireTime(nItemIdx,nYears,nMonths,nDays,23,59,0);
		Msg2Player("Sö dông vËt phÈm ngoµi sù kiÖn. NhËn ®­îc "..ChoosenTableReward[nRand][3][4].." "..nName);
		
		ModifyExp(2000000);
		Msg2Player("B¹n nhËn ®­îc 2.000.000 Kinh NghiÖm");
		
		local Random = random(1,100);
		if Random <= 10 then 
			ModifyExp(5000000);
			Msg2Player("B¹n nhËn ®­îc 5.000.000 Kinh NghiÖm");
		end
		bonus();
	end
	ET_OnItemUse(nItemIndex)
end

function getExpireTime(days)
	local curHour = tonumber(date("%H"));
	local curMinute = tonumber(date("%M"));
	local curSecond = tonumber(date("%S"));
	local expireTime = 0; -- edit later
	return curHour;
end;

function bonus()
	local nYears,nMonths,nDays = GmTime(GetTime()+86400*7);
	local nRand = random(1000);
	
	-- PhÇn th­ëng siªu ®Æc biÖt
	if random(1000) == 1000 then
		
		local nRand, nName = GetRandByID(ListGif_5);
		local nRet, nItemIdx = gf_AddItemEx2(ListGif_5[nRand][3],ListGif_5[nRand][1]);
		--SetItemExpireTime(nItemIdx,3600*72);
		local szMsg = "NhËn ®­îc phÇn th­ëng siªu hiÕm: "..ListGif_5[nRand][3][4].." "..nName;
		Msg2Player(szMsg);
		Talk(1,"",szMsg);
	end
	
	-- PhÇn th­ëng may m¾n
	if random(500) == 500 then
		
		local nRand, nName = GetRandByID(ListGif_4);
		local nRet, nItemIdx = gf_AddItemEx2(ListGif_4[nRand][3],ListGif_4[nRand][1]);
		--SetItemExpireTime(nItemIdx,3600*72);
		local szMsg = "NhËn ®­îc phÇn th­ëng may m¾n: "..ListGif_4[nRand][3][4].." "..nName;
		Msg2Player(szMsg);
		--Talk(1,"",szMsg);
	end
	
	-- PhÇn th­ëng ngÉu nhiªn
	if random(100) == 100 then
		
		local nRand, nName = GetRandByID(ListGif_3);
		local nRet, nItemIdx = gf_AddItemEx2(ListGif_3[nRand][3],ListGif_3[nRand][1]);
		--SetItemExpireTime(nItemIdx,getExpireTime()+3600*72);
		gf_SetItemExpireTime(nItemIdx,nYears,nMonths,nDays,23,59,0);
		local szMsg = "NhËn ®­îc phÇn th­ëng ®Æc biÖt: "..ListGif_3[nRand][3][4].." "..nName;
		Msg2Player(szMsg);
		--Talk(1,"",szMsg);
	end
	
end;